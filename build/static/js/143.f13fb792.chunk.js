"use strict";(self.webpackChunkquran_memorization_web=self.webpackChunkquran_memorization_web||[]).push([[143],{143:(e,a,t)=>{t.r(a),t.d(a,{default:()=>h});var r=t(5043),s=t(4973),l=t(6667),d=t(5591),n=t(5016),i=t(7304),o=t(6058),c=t(579);function h(){const{currentUser:e,userRole:a}=(0,n.A)(),[t,i]=(0,r.useState)([]),[h,u]=(0,r.useState)([]),[m,g]=(0,r.useState)([]),[p,x]=(0,r.useState)([]),[j,b]=(0,r.useState)(!0),[v,f]=(0,r.useState)(""),[N,y]=(0,r.useState)(!1),[M,F]=(0,r.useState)(""),[C,D]=(0,r.useState)(""),[S,k]=(0,r.useState)(""),[P,q]=(0,r.useState)(""),[R,_]=(0,r.useState)(""),[w,I]=(0,r.useState)(null),[G,z]=(0,r.useState)(null),E=(0,r.useCallback)(async()=>{if(e)try{let t=(0,l.rJ)(s.db,"students"),r=(0,l.rJ)(s.db,"halaqat");if("teacher"===a){const a=(await(0,l.GG)((0,l.P)((0,l.rJ)(s.db,"halaqat"),(0,l._M)("teacherId","==",e.uid)))).docs.map(e=>e.id);if(!(a.length>0))return u([]),g([]),void x([]);t=(0,l.P)((0,l.rJ)(s.db,"students"),(0,l._M)("halaqaId","in",a)),r=(0,l.P)((0,l.rJ)(s.db,"halaqat"),(0,l._M)("teacherId","==",e.uid))}const[d,n,i]=await Promise.all([(0,l.GG)(t),(0,l.GG)(r),(0,l.GG)((0,l.P)((0,l.rJ)(s.db,"users"),(0,l._M)("role","==","teacher")))]),o=d.docs.map(e=>({id:e.id,...e.data()})),c=n.docs.map(e=>({id:e.id,...e.data()})),h=i.docs.map(e=>({id:e.id,name:e.data().name||e.data().email}));u(o),g(c),x(h)}catch(t){console.error("Error fetching dropdown data:",t),f("\u0641\u0634\u0644 \u0641\u064a \u062c\u0644\u0628 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0642\u0648\u0627\u0626\u0645 \u0627\u0644\u0645\u0646\u0633\u062f\u0644\u0629.")}},[e,a]);(0,r.useEffect)(()=>{E()},[E]);const J=(0,r.useCallback)(async()=>{b(!0),f(""),i([]),I(null),z(null),y(!1);let t=(0,l.rJ)(s.db,"weeklyReports"),r=[];if(M&&r.push((0,l._M)("studentId","==",M)),C&&r.push((0,l._M)("halaqaId","==",C)),"teacher"===a&&null!==e&&void 0!==e&&e.uid){const a=m.filter(a=>a.teacherId===e.uid).map(e=>e.id);if(!(a.length>0))return b(!1),void f("\u0644\u064a\u0633 \u0644\u062f\u064a\u0643 \u062d\u0644\u0642\u0627\u062a \u0645\u0631\u062a\u0628\u0637\u0629 \u0644\u0639\u0631\u0636 \u0627\u0644\u062a\u0642\u0627\u0631\u064a\u0631.");r.push((0,l._M)("halaqaId","in",a))}else if("admin"===a&&S){const e=m.filter(e=>e.teacherId===S).map(e=>e.id);if(!(e.length>0))return b(!1),void f("\u0627\u0644\u0645\u0639\u0644\u0645 \u0627\u0644\u0645\u062d\u062f\u062f \u0644\u064a\u0633 \u0644\u062f\u064a\u0647 \u062d\u0644\u0642\u0627\u062a \u0645\u0631\u062a\u0628\u0637\u0629.");r.push((0,l._M)("halaqaId","in",e))}P&&r.push((0,l._M)("reportDate",">=",P)),R&&r.push((0,l._M)("reportDate","<=",R));try{const e=(0,l.P)(t,...r,(0,l.My)("reportDate","asc")),a=await(0,l.GG)(e),s=[];let d=0,n=0,o=0,c=0,u=0;const g={};a.forEach(e=>{var a,t,r,l;const i=e.data(),x=(null===(a=h.find(e=>e.id===i.studentId))||void 0===a?void 0:a.name)||"\u063a\u064a\u0631 \u0645\u0639\u0631\u0648\u0641",j=(null===(t=m.find(e=>e.id===i.halaqaId))||void 0===t?void 0:t.name)||"\u063a\u064a\u0631 \u0645\u0639\u0631\u0648\u0641",b=null===(r=m.find(e=>e.id===i.halaqaId))||void 0===r?void 0:r.teacherId,v=(null===(l=p.find(e=>e.id===b))||void 0===l?void 0:l.name)||"\u063a\u064a\u0631 \u0645\u0639\u0631\u0648\u0641";s.push({id:e.id,studentName:x,halaqaName:j,teacherName:v,reportDateFormatted:i.reportDate,...i}),d+=i.pagesMemorized||0,n+=i.partsRevised||0,o+=i.attendanceDays||0,c+=i.rating||0,u++;const f=new Date(i.reportDate),N=`${f.getFullYear()}-${(f.getMonth()+1).toString().padStart(2,"0")}`,y=f.toLocaleString("ar-EG",{month:"long",year:"numeric"});g[N]||(g[N]={monthLabel:y,totalPagesMemorized:0,totalPartsRevised:0,totalAttendanceDays:0,totalRating:0,count:0}),g[N].totalPagesMemorized+=i.pagesMemorized||0,g[N].totalPartsRevised+=i.partsRevised||0,g[N].totalAttendanceDays+=i.attendanceDays||0,g[N].totalRating+=i.rating||0,g[N].count++}),i(s),y(!0),I(u>0?{labels:["\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u062d\u0641\u0638 (\u0635\u0641\u062d\u0627\u062a)","\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0645\u0631\u0627\u062c\u0639\u0629 (\u0623\u062c\u0632\u0627\u0621)","\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u062d\u0636\u0648\u0631 (\u0623\u064a\u0627\u0645)","\u0645\u062a\u0648\u0633\u0637 \u0627\u0644\u062a\u0642\u064a\u064a\u0645"],datasets:[{label:"\u0625\u062d\u0635\u0627\u0626\u064a\u0627\u062a \u0627\u0644\u062a\u0642\u0627\u0631\u064a\u0631 \u0627\u0644\u0645\u062d\u062f\u062f\u0629",data:[d,n,o,(c/u).toFixed(2)],backgroundColor:["rgba(54, 162, 235, 0.6)","rgba(75, 192, 192, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)"],borderColor:["rgba(54, 162, 235, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)"],borderWidth:1}]}:null);const x=Object.keys(g).sort();if(x.length>0){const e=x.map(e=>g[e].monthLabel),a=x.map(e=>(g[e].totalPagesMemorized/g[e].count).toFixed(2)),t=x.map(e=>(g[e].totalPartsRevised/g[e].count).toFixed(2)),r=x.map(e=>(g[e].totalAttendanceDays/g[e].count).toFixed(2)),s=x.map(e=>(g[e].totalRating/g[e].count).toFixed(2));z({labels:e,datasets:[{label:"\u0645\u062a\u0648\u0633\u0637 \u0627\u0644\u062d\u0641\u0638 (\u0635\u0641\u062d\u0627\u062a)",data:a,backgroundColor:"rgba(54, 162, 235, 0.6)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1},{label:"\u0645\u062a\u0648\u0633\u0637 \u0627\u0644\u0645\u0631\u0627\u062c\u0639\u0629 (\u0623\u062c\u0632\u0627\u0621)",data:t,backgroundColor:"rgba(75, 192, 192, 0.6)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1},{label:"\u0645\u062a\u0648\u0633\u0637 \u0627\u0644\u062d\u0636\u0648\u0631 (\u0623\u064a\u0627\u0645)",data:r,backgroundColor:"rgba(153, 102, 255, 0.6)",borderColor:"rgba(153, 102, 255, 1)",borderWidth:1},{label:"\u0645\u062a\u0648\u0633\u0637 \u0627\u0644\u062a\u0642\u064a\u064a\u0645",data:s,backgroundColor:"rgba(255, 159, 64, 0.6)",borderColor:"rgba(255, 159, 64, 1)",borderWidth:1}]})}else z(null)}catch(d){console.error("Error fetching reports:",d),f("\u0641\u0634\u0644 \u0641\u064a \u062c\u0644\u0628 \u0627\u0644\u062a\u0642\u0627\u0631\u064a\u0631: "+d.message)}finally{b(!1)}},[M,C,S,P,R,h,m,p,a,e]);return(0,c.jsxs)("div",{className:"reports-page-container page-container",children:[(0,c.jsx)("h2",{className:"reports-title",children:"\u0627\u0644\u062a\u0642\u0627\u0631\u064a\u0631 \u0648\u0627\u0644\u0625\u062d\u0635\u0627\u0626\u064a\u0627\u062a"}),(0,c.jsxs)("div",{className:"filters-section card",children:[(0,c.jsx)("h3",{children:"\u062a\u0635\u0641\u064a\u0629 \u0627\u0644\u062a\u0642\u0627\u0631\u064a\u0631"}),(0,c.jsxs)("div",{className:"filters-grid",children:[(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{htmlFor:"student-filter",children:"\u0627\u0644\u0637\u0627\u0644\u0628:"}),(0,c.jsxs)("select",{id:"student-filter",value:M,onChange:e=>F(e.target.value),className:"filter-select",children:[(0,c.jsx)("option",{value:"",children:"\u062c\u0645\u064a\u0639 \u0627\u0644\u0637\u0644\u0627\u0628"}),h.map(e=>(0,c.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{htmlFor:"halaqa-filter",children:"\u0627\u0644\u062d\u0644\u0642\u0629:"}),(0,c.jsxs)("select",{id:"halaqa-filter",value:C,onChange:e=>D(e.target.value),className:"filter-select",children:[(0,c.jsx)("option",{value:"",children:"\u062c\u0645\u064a\u0639 \u0627\u0644\u062d\u0644\u0642\u0627\u062a"}),m.map(e=>(0,c.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),"admin"===a&&(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{htmlFor:"teacher-filter",children:"\u0627\u0644\u0645\u0639\u0644\u0645:"}),(0,c.jsxs)("select",{id:"teacher-filter",value:S,onChange:e=>k(e.target.value),className:"filter-select",children:[(0,c.jsx)("option",{value:"",children:"\u062c\u0645\u064a\u0639 \u0627\u0644\u0645\u0639\u0644\u0645\u064a\u0646"}),p.map(e=>(0,c.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{htmlFor:"start-date-filter",children:"\u0645\u0646 \u062a\u0627\u0631\u064a\u062e:"}),(0,c.jsx)("input",{type:"date",id:"start-date-filter",value:P,onChange:e=>q(e.target.value),className:"filter-input"})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{htmlFor:"end-date-filter",children:"\u0625\u0644\u0649 \u062a\u0627\u0631\u064a\u062e:"}),(0,c.jsx)("input",{type:"date",id:"end-date-filter",value:R,onChange:e=>_(e.target.value),className:"filter-input"})]})]}),(0,c.jsx)("button",{onClick:J,className:"view-reports-button",disabled:j,children:j?"\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644...":"\u0639\u0631\u0636 \u0627\u0644\u062a\u0642\u0627\u0631\u064a\u0631"})]}),j&&(0,c.jsx)("p",{className:"loading-message",children:"\u062c\u0627\u0631\u064a \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a..."}),v&&(0,c.jsx)("p",{className:"error-message",children:v}),N&&t.length>0&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{className:"report-charts-section card",children:[(0,c.jsx)("h3",{children:"\u0631\u0633\u0648\u0645 \u0628\u064a\u0627\u0646\u064a\u0629 \u0625\u062d\u0635\u0627\u0626\u064a\u0629 \u0644\u0644\u062a\u0642\u0627\u0631\u064a\u0631 \u0627\u0644\u0645\u062d\u062f\u062f\u0629"}),w?(0,c.jsx)("div",{className:"chart-container",children:(0,c.jsx)(o.yP,{data:w,options:{responsive:!0,maintainAspectRatio:!1}})}):(0,c.jsx)("p",{className:"no-chart-data",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0628\u064a\u0627\u0646\u0627\u062a \u0643\u0627\u0641\u064a\u0629 \u0644\u0625\u0646\u0634\u0627\u0621 \u0627\u0644\u0631\u0633\u0645 \u0627\u0644\u0628\u064a\u0627\u0646\u064a \u0627\u0644\u0625\u062c\u0645\u0627\u0644\u064a."})]}),(0,c.jsxs)("div",{className:"monthly-average-chart-section card",children:[(0,c.jsx)("h3",{children:"\u0645\u062a\u0648\u0633\u0637 \u0627\u0644\u0623\u062f\u0627\u0621 \u0627\u0644\u0634\u0647\u0631\u064a"}),G?(0,c.jsx)("div",{className:"chart-container",children:(0,c.jsx)(o.yP,{data:G,options:{responsive:!0,maintainAspectRatio:!1}})}):(0,c.jsx)("p",{className:"no-chart-data",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0628\u064a\u0627\u0646\u0627\u062a \u0643\u0627\u0641\u064a\u0629 \u0644\u0625\u0646\u0634\u0627\u0621 \u0631\u0633\u0645 \u0628\u064a\u0627\u0646\u064a \u0644\u0644\u0645\u062a\u0648\u0633\u0637\u0627\u062a \u0627\u0644\u0634\u0647\u0631\u064a\u0629."})]}),(0,c.jsxs)("div",{className:"report-table-section card",children:[(0,c.jsxs)("div",{className:"table-header-actions",children:[(0,c.jsx)("h3",{children:"\u0627\u0644\u062a\u0642\u0627\u0631\u064a\u0631 \u0627\u0644\u062a\u0641\u0635\u064a\u0644\u064a\u0629"}),(0,c.jsx)("button",{onClick:()=>{if(0===t.length)return void alert("\u0644\u0627 \u062a\u0648\u062c\u062f \u062a\u0642\u0627\u0631\u064a\u0631 \u0644\u062a\u0635\u062f\u064a\u0631\u0647\u0627.");let r=null;if("admin"===a&&S){const e=p.find(e=>e.id===S);r=e?e.name:null}else"teacher"===a&&null!==e&&void 0!==e&&e.displayName?r=e.displayName:"teacher"===a&&null!==e&&void 0!==e&&e.email&&(r=e.email);let s=null,l=null,n="custom";if(P&&R){const e=new Date(P),a=new Date(R),t=["\u064a\u0646\u0627\u064a\u0631","\u0641\u0628\u0631\u0627\u064a\u0631","\u0645\u0627\u0631\u0633","\u0623\u0628\u0631\u064a\u0644","\u0645\u0627\u064a\u0648","\u064a\u0648\u0646\u064a\u0648","\u064a\u0648\u0644\u064a\u0648","\u0623\u063a\u0633\u0637\u0633","\u0633\u0628\u062a\u0645\u0628\u0631","\u0623\u0643\u062a\u0648\u0628\u0631","\u0646\u0648\u0641\u0645\u0628\u0631","\u062f\u064a\u0633\u0645\u0628\u0631"];e.getMonth()===a.getMonth()&&e.getFullYear()===a.getFullYear()?(s=t[e.getMonth()],l=e.getFullYear().toString(),n="monthly"):e.getFullYear()===a.getFullYear()&&0===e.getMonth()&&11===a.getMonth()&&1===e.getDate()&&31===a.getDate()?(l=e.getFullYear().toString(),n="annual"):n="custom"}const i=t.map(e=>[e.notes,`${e.rating}/100`,e.attendanceDays,e.partsRevised,e.pagesMemorized,e.reportDateFormatted,e.halaqaName,e.studentName].reverse());(0,d.U)(n,["\u0645\u0644\u0627\u062d\u0638\u0627\u062a","\u0627\u0644\u062a\u0642\u064a\u064a\u0645","\u0623\u064a\u0627\u0645 \u0627\u0644\u062d\u0636\u0648\u0631","\u0623\u062c\u0632\u0627\u0621 \u0627\u0644\u0645\u0631\u0627\u062c\u0639\u0629","\u0635\u0641\u062d\u0627\u062a \u0627\u0644\u062d\u0641\u0638","\u0627\u0644\u062a\u0627\u0631\u064a\u062e","\u0627\u0644\u062d\u0644\u0642\u0629","\u0627\u0644\u0637\u0627\u0644\u0628"],i,"WeeklyReports",r,s,l)},className:"export-pdf-button",children:"\u062a\u0635\u062f\u064a\u0631 \u0625\u0644\u0649 PDF"})]}),t.length>0?(0,c.jsx)(c.Fragment,{children:(0,c.jsx)("div",{className:"table-responsive",children:(0,c.jsxs)("table",{className:"reports-table",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{children:"\u0627\u0644\u0637\u0627\u0644\u0628"}),(0,c.jsx)("th",{children:"\u0627\u0644\u062d\u0644\u0642\u0629"}),(0,c.jsx)("th",{children:"\u0627\u0644\u0645\u0639\u0644\u0645"}),(0,c.jsx)("th",{children:"\u0627\u0644\u062a\u0627\u0631\u064a\u062e"}),(0,c.jsx)("th",{children:"\u0635\u0641\u062d\u0627\u062a \u0627\u0644\u062d\u0641\u0638"}),(0,c.jsx)("th",{children:"\u0623\u062c\u0632\u0627\u0621 \u0627\u0644\u0645\u0631\u0627\u062c\u0639\u0629"}),(0,c.jsx)("th",{children:"\u0623\u064a\u0627\u0645 \u0627\u0644\u062d\u0636\u0648\u0631"}),(0,c.jsx)("th",{children:"\u0627\u0644\u062a\u0642\u064a\u064a\u0645"}),(0,c.jsx)("th",{children:"\u0645\u0644\u0627\u062d\u0638\u0627\u062a"})]})}),(0,c.jsx)("tbody",{children:t.map(e=>(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{children:e.studentName}),(0,c.jsx)("td",{children:e.halaqaName}),(0,c.jsx)("td",{children:e.teacherName}),(0,c.jsx)("td",{children:e.reportDateFormatted}),(0,c.jsx)("td",{children:e.pagesMemorized}),(0,c.jsx)("td",{children:e.partsRevised}),(0,c.jsx)("td",{children:e.attendanceDays}),(0,c.jsxs)("td",{children:[e.rating,"/100"]}),(0,c.jsx)("td",{children:e.notes})]},e.id))})]})})}):(0,c.jsx)("p",{className:"no-data-message",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u062a\u0642\u0627\u0631\u064a\u0631 \u062a\u0641\u0635\u064a\u0644\u064a\u0629 \u0644\u0639\u0631\u0636\u0647\u0627 \u0628\u0646\u0627\u0621\u064b \u0639\u0644\u0649 \u0627\u0644\u0645\u0639\u0627\u064a\u064a\u0631 \u0627\u0644\u0645\u062d\u062f\u062f\u0629."})]})]}),0===t.length&&!j&&!v&&!N&&(0,c.jsx)("p",{className:"info-message",children:'\u064a\u0631\u062c\u0649 \u062a\u062d\u062f\u064a\u062f \u0645\u0639\u0627\u064a\u064a\u0631 \u0627\u0644\u062a\u0642\u0631\u064a\u0631 \u0648\u0627\u0644\u0646\u0642\u0631 \u0639\u0644\u0649 "\u0639\u0631\u0636 \u0627\u0644\u062a\u0642\u0627\u0631\u064a\u0631".'})]})}i.t1.register(i.PP,i.kc,i.E8,i.hE,i.m_,i.s$)}}]);
//# sourceMappingURL=143.f13fb792.chunk.js.map