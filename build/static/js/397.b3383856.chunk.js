"use strict";(self.webpackChunkquran_memorization_web=self.webpackChunkquran_memorization_web||[]).push([[397],{2673:(e,a,s)=>{s.d(a,{A:()=>t});var l=s(5043),n=s(579);const t=e=>{let{isOpen:a,title:s,message:t,children:r,onConfirm:c,onCancel:i,showCancelButton:d=!0,closeOnOverlayClick:o=!1}=e;const h=(0,l.useRef)(null);if((0,l.useEffect)(()=>{if(a){var e;null===(e=h.current)||void 0===e||e.focus();const a=e=>{"Escape"===e.key&&i()};return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}}},[a,i]),!a)return null;return(0,n.jsx)("div",{className:"modal-overlay",onClick:e=>{o&&h.current&&!h.current.contains(e.target)&&i()},children:(0,n.jsxs)("div",{className:"modal-content",ref:h,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title","aria-describedby":"modal-message",tabIndex:"-1",children:[(0,n.jsx)("h3",{id:"modal-title",className:"modal-title",children:s}),t&&(0,n.jsx)("p",{id:"modal-message",className:"modal-message",children:t}),r&&(0,n.jsx)("div",{className:"modal-body",children:r})," ",(0,n.jsxs)("div",{className:"modal-actions",children:[(0,n.jsx)("button",{onClick:c,className:"modal-confirm-button",children:"\u062a\u0623\u0643\u064a\u062f"}),d&&(0,n.jsx)("button",{onClick:i,className:"modal-cancel-button",children:"\u0625\u0644\u063a\u0627\u0621"})]})]})})}},4397:(e,a,s)=>{s.r(a),s.d(a,{default:()=>m});var l=s(5043),n=s(4973),t=s(6667),r=s(5016),c=s(2673),i=s(579);const d=e=>{let{halaqa:a,isEditing:s,onEdit:n,onDelete:t,onSave:r,onCancel:c,teachers:d,userRole:o,loading:h}=e;const[u,m]=(0,l.useState)(a.name),[g,v]=(0,l.useState)(a.teacherId||"");(0,l.useEffect)(()=>{s&&(m(a.name),v(a.teacherId||""))},[a,s]);const x=(0,l.useCallback)(()=>{r(a.id,u,g)},[a.id,u,g,r]);return s?(0,i.jsxs)("div",{className:"edit-halaqa-form",children:[(0,i.jsx)("input",{type:"text",value:u,onChange:e=>m(e.target.value),className:"edit-halaqa-input",required:!0}),"admin"===o&&(0,i.jsxs)("select",{value:g,onChange:e=>v(e.target.value),className:"edit-halaqa-select-teacher",required:!0,children:[(0,i.jsx)("option",{value:"",children:"\u0627\u062e\u062a\u0631 \u0627\u0644\u0645\u0639\u0644\u0645"}),d.map(e=>(0,i.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,i.jsx)("button",{onClick:x,className:"save-button",disabled:h,children:h?"\u062c\u0627\u0631\u064a \u0627\u0644\u062d\u0641\u0638...":"\u062d\u0641\u0638"}),(0,i.jsx)("button",{onClick:c,className:"cancel-button",disabled:h,children:"\u0625\u0644\u063a\u0627\u0621"})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"halaqa-details",children:(0,i.jsxs)("span",{children:[a.name," (",a.teacherName||"\u0644\u0627 \u064a\u0648\u062c\u062f \u0645\u0639\u0644\u0645",")"]})}),(0,i.jsxs)("div",{className:"halaqa-actions",children:[(0,i.jsx)("button",{onClick:()=>n(a),className:"edit-button",children:"\u062a\u0639\u062f\u064a\u0644"}),(0,i.jsx)("button",{onClick:()=>t(a.id),className:"delete-button",children:"\u062d\u0630\u0641"})]})]})},o=l.memo(d),h=e=>{let{newHalaqaName:a,setNewHalaqaName:s,selectedTeacherId:n,setSelectedTeacherId:t,teachers:r,userRole:c,loading:d,onAddHalaqa:o,error:h,message:u}=e;const m=(0,l.useCallback)(()=>{o()},[o]);return"admin"!==c&&"teacher"!==c?null:(0,i.jsxs)("div",{className:"add-halaqa-section card",children:[(0,i.jsx)("h3",{children:"\u0625\u0636\u0627\u0641\u0629 \u062d\u0644\u0642\u0629 \u062c\u062f\u064a\u062f\u0629"}),h&&(0,i.jsx)("p",{className:"error-message",children:h})," ",u&&(0,i.jsx)("p",{className:"success-message",children:u})," ",(0,i.jsx)("input",{type:"text",placeholder:"\u0627\u0633\u0645 \u0627\u0644\u062d\u0644\u0642\u0629 \u0627\u0644\u062c\u062f\u064a\u062f\u0629",value:a,onChange:e=>s(e.target.value),className:"new-halaqa-input",required:!0}),"admin"===c&&(0,i.jsxs)("select",{value:n,onChange:e=>t(e.target.value),className:"new-halaqa-select-teacher",required:!0,children:[(0,i.jsx)("option",{value:"",children:"\u0627\u062e\u062a\u0631 \u0627\u0644\u0645\u0639\u0644\u0645"}),r.map(e=>(0,i.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,i.jsx)("button",{onClick:m,className:"add-halaqa-button",disabled:d,children:d?"\u062c\u0627\u0631\u064a \u0627\u0644\u0625\u0636\u0627\u0641\u0629...":"\u0625\u0636\u0627\u0641\u0629 \u062d\u0644\u0642\u0629 \u062c\u062f\u064a\u062f\u0629"})]})},u=l.memo(h);function m(){const{currentUser:e,userRole:a,loading:s}=(0,r.A)(),[d,h]=(0,l.useState)([]),[m,g]=(0,l.useState)([]),[v,x]=(0,l.useState)(""),[j,N]=(0,l.useState)(""),[b,f]=(0,l.useState)(null),[C,p]=(0,l.useState)(!0),[q,k]=(0,l.useState)(""),[w,y]=(0,l.useState)(""),[E,S]=(0,l.useState)(!1),[I,H]=(0,l.useState)({});(0,l.useEffect)(()=>{if(s||!e)return void p(!1);let l,r;p(!0),k("");try{let s;if(r=(0,t.aQ)((0,t.rJ)(n.db,"teachers"),e=>{const a=[];e.forEach(e=>{a.push({id:e.id,...e.data()})}),g(a),p(!1)},e=>{console.error("Error fetching teachers:",e),k("\u0641\u0634\u0644 \u0641\u064a \u062c\u0644\u0628 \u0627\u0644\u0645\u0639\u0644\u0645\u064a\u0646: "+e.message),p(!1)}),"teacher"===a)s=(0,t.P)((0,t.rJ)(n.db,"halaqat"),(0,t._M)("teacherId","==",e.uid));else{if("admin"!==a)return h([]),void p(!1);s=(0,t.rJ)(n.db,"halaqat")}l=(0,t.aQ)(s,e=>{const a=[];e.forEach(e=>{a.push({id:e.id,...e.data()})}),h(a),p(!1)},e=>{console.error("Error fetching halaqat:",e),k("\u0641\u0634\u0644 \u0641\u064a \u062c\u0644\u0628 \u0627\u0644\u062d\u0644\u0642\u0627\u062a: "+e.message),p(!1)})}catch(c){console.error("Error setting up listeners:",c),k("\u062d\u062f\u062b \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u0625\u0639\u062f\u0627\u062f \u0645\u0633\u062a\u0645\u0639\u064a \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a: "+c.message),p(!1)}return()=>{l&&l(),r&&r()}},[e,a,s]);const R=(0,l.useCallback)(async()=>{if(k(""),y(""),v.trim())if("admin"!==a||j){p(!0);try{var s,l;const r="teacher"===a?(null===(s=m.find(a=>a.id===e.uid))||void 0===s?void 0:s.name)||"\u063a\u064a\u0631 \u0645\u0639\u0631\u0648\u0641":(null===(l=m.find(e=>e.id===j))||void 0===l?void 0:l.name)||"\u063a\u064a\u0631 \u0645\u0639\u0631\u0648\u0641",c={name:v,teacherId:"teacher"===a?e.uid:j,teacherName:r};await(0,t.gS)((0,t.rJ)(n.db,"halaqat"),c),x(""),N(""),y("\u062a\u0645 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u062d\u0644\u0642\u0629 \u0628\u0646\u062c\u0627\u062d!")}catch(r){console.error("Error adding halaqa:",r),k("\u0641\u0634\u0644 \u0641\u064a \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u062d\u0644\u0642\u0629: "+r.message)}finally{p(!1)}}else k("\u064a\u0631\u062c\u0649 \u0627\u062e\u062a\u064a\u0627\u0631 \u0645\u0639\u0644\u0645 \u0644\u0644\u062d\u0644\u0642\u0629.");else k("\u064a\u0631\u062c\u0649 \u0625\u062f\u062e\u0627\u0644 \u0627\u0633\u0645 \u0627\u0644\u062d\u0644\u0642\u0629.")},[v,j,a,e,m]),A=(0,l.useCallback)(e=>{f(e.id),k(""),y("")},[]),_=(0,l.useCallback)(async(s,l,r)=>{if(k(""),y(""),l.trim())if("admin"!==a||r){p(!0);try{var c,i;const d=(0,t.H9)(n.db,"halaqat",s),o="teacher"===a?(null===(c=m.find(a=>a.id===e.uid))||void 0===c?void 0:c.name)||"\u063a\u064a\u0631 \u0645\u0639\u0631\u0648\u0641":(null===(i=m.find(e=>e.id===r))||void 0===i?void 0:i.name)||"\u063a\u064a\u0631 \u0645\u0639\u0631\u0648\u0641",h={name:l,teacherId:"teacher"===a?e.uid:r,teacherName:o};await(0,t.mZ)(d,h),f(null),y("\u062a\u0645 \u062a\u062d\u062f\u064a\u062b \u0627\u0644\u062d\u0644\u0642\u0629 \u0628\u0646\u062c\u0627\u062d!")}catch(d){console.error("Error updating halaqa:",d),k("\u0641\u0634\u0644 \u0641\u064a \u062a\u062d\u062f\u064a\u062b \u0627\u0644\u062d\u0644\u0642\u0629: "+d.message)}finally{p(!1)}}else k("\u064a\u0631\u062c\u0649 \u0627\u062e\u062a\u064a\u0627\u0631 \u0645\u0639\u0644\u0645 \u0644\u0644\u062d\u0644\u0642\u0629.");else k("\u064a\u0631\u062c\u0649 \u0625\u062f\u062e\u0627\u0644 \u0627\u0633\u0645 \u0627\u0644\u062d\u0644\u0642\u0629.")},[a,e,m]),B=(0,l.useCallback)(()=>{f(null),k(""),y("")},[]),J=(0,l.useCallback)(e=>{H({title:"\u062a\u0623\u0643\u064a\u062f \u0627\u0644\u062d\u0630\u0641",message:"\u0647\u0644 \u0623\u0646\u062a \u0645\u062a\u0623\u0643\u062f \u0623\u0646\u0643 \u062a\u0631\u064a\u062f \u062d\u0630\u0641 \u0647\u0630\u0647 \u0627\u0644\u062d\u0644\u0642\u0629\u061f (\u0645\u0644\u0627\u062d\u0638\u0629: \u062d\u0630\u0641 \u0627\u0644\u0637\u0644\u0627\u0628 \u0627\u0644\u0645\u0631\u062a\u0628\u0637\u064a\u0646 \u064a\u062c\u0628 \u0623\u0646 \u064a\u062a\u0645 \u0639\u0628\u0631 Cloud Function \u0644\u0636\u0645\u0627\u0646 \u0627\u0644\u0623\u0645\u0627\u0646).",onConfirm:async()=>{S(!1),p(!0),k(""),y("");try{await(0,t.kd)((0,t.H9)(n.db,"halaqat",e)),y("\u062a\u0645 \u062d\u0630\u0641 \u0627\u0644\u062d\u0644\u0642\u0629 \u0628\u0646\u062c\u0627\u062d! (\u062a\u0623\u0643\u062f \u0645\u0646 \u0625\u0639\u062f\u0627\u062f Cloud Function \u0644\u062d\u0630\u0641 \u0627\u0644\u0637\u0644\u0627\u0628 \u0627\u0644\u0645\u0631\u062a\u0628\u0637\u064a\u0646).")}catch(a){console.error("Error deleting halaqa:",a),k("\u0641\u0634\u0644 \u0641\u064a \u062d\u0630\u0641 \u0627\u0644\u062d\u0644\u0642\u0629: "+a.message)}finally{p(!1)}},onCancel:()=>S(!1),showCancelButton:!0}),S(!0)},[]);return"admin"!==a&&"teacher"!==a?(0,i.jsx)("div",{className:"unauthorized-message",children:"\u0644\u064a\u0633 \u0644\u062f\u064a\u0643 \u0627\u0644\u0635\u0644\u0627\u062d\u064a\u0629 \u0644\u0644\u0648\u0635\u0648\u0644 \u0625\u0644\u0649 \u0647\u0630\u0647 \u0627\u0644\u0635\u0641\u062d\u0629."}):C?(0,i.jsx)("p",{className:"loading-message",children:"\u062c\u0627\u0631\u064a \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u062d\u0644\u0642\u0627\u062a..."}):(0,i.jsxs)("div",{className:"halaqat-page-container page-container",children:[(0,i.jsx)("h2",{className:"halaqat-page-title",children:"\u0625\u062f\u0627\u0631\u0629 \u0627\u0644\u062d\u0644\u0642\u0627\u062a"}),q&&(0,i.jsx)("p",{className:"error-message",children:q}),w&&(0,i.jsx)("p",{className:"success-message",children:w}),(0,i.jsxs)("div",{className:"halaqat-list-section card",children:[(0,i.jsx)("h3",{children:"\u0627\u0644\u062d\u0644\u0642\u0627\u062a \u0627\u0644\u062d\u0627\u0644\u064a\u0629"}),0===d.length?(0,i.jsx)("p",{className:"no-data-message",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u062d\u0644\u0642\u0627\u062a \u0644\u0639\u0631\u0636\u0647\u0627."}):(0,i.jsx)("ul",{className:"halaqat-list",children:d.map(e=>(0,i.jsx)("li",{className:"halaqa-item-wrapper",children:(0,i.jsx)(o,{halaqa:e,isEditing:b===e.id,onEdit:A,onDelete:J,onSave:_,onCancel:B,teachers:m,userRole:a,loading:C})},e.id))})]}),(0,i.jsx)(u,{newHalaqaName:v,setNewHalaqaName:x,selectedTeacherId:j,setSelectedTeacherId:N,teachers:m,userRole:a,loading:C,onAddHalaqa:R}),(0,i.jsx)(c.A,{isOpen:E,title:I.title,message:I.message,onConfirm:I.onConfirm,onCancel:I.onCancel,showCancelButton:I.showCancelButton})]})}}}]);
//# sourceMappingURL=397.b3383856.chunk.js.map