"use strict";(self.webpackChunkquran_memorization_web=self.webpackChunkquran_memorization_web||[]).push([[985],{2985:(a,e,s)=>{s.r(e),s.d(e,{default:()=>o});var t=s(5043),r=s(4973),n=s(6667),l=s(5016),c=s(6058),i=s(7304),d=s(579);function o(){const{userRole:a,currentUser:e}=(0,l.A)(),[s,i]=(0,t.useState)({totalStudents:0,totalHalaqat:0,totalTeachers:0,studentDistribution:{},averageMemorization:0,averageRevision:0,averageAttendance:0,halaqaNamesMap:{}}),[o,h]=(0,t.useState)(!0),[m,u]=(0,t.useState)(""),[p,j]=(0,t.useState)(null),[x,g]=(0,t.useState)(null),[N,v]=(0,t.useState)({}),[b,q]=(0,t.useState)(null),[f,F]=(0,t.useState)({}),E=(0,t.useCallback)(async()=>{h(!0),u("");try{let s=(0,n.rJ)(r.db,"students"),t=((0,n.rJ)(r.db,"halaqat"),(0,n.rJ)(r.db,"weeklyReports")),l=(0,n.rJ)(r.db,"users");const c=await(0,n.GG)((0,n.rJ)(r.db,"halaqat")),d={};c.forEach(a=>{d[a.id]=a.data().name});const o=await(0,n.GG)((0,n.rJ)(r.db,"students")),m={};o.forEach(a=>{m[a.id]=a.data().name});const u=await(0,n.GG)((0,n.rJ)(r.db,"users")),p={};if(u.docs.filter(a=>"teacher"===a.data().role).forEach(a=>{p[a.id]=a.data().name||a.data().email}),"teacher"===a&&e){const a=await(0,n.GG)((0,n.P)((0,n.rJ)(r.db,"halaqat"),(0,n._M)("teacherId","==",e.uid))),l=a.docs.map(a=>a.id);if(0===l.length)return i({totalStudents:0,totalHalaqat:0,totalTeachers:0,studentDistribution:{},averageMemorization:0,averageRevision:0,averageAttendance:0,halaqaNamesMap:{}}),j(null),g(null),v({}),q(null),F({}),void h(!1);s=(0,n.P)(s,(0,n._M)("halaqaId","in",l)),t=(0,n.P)(t,(0,n._M)("halaqaId","in",l));const c={};a.forEach(a=>{c[a.id]=a.data().name}),i(a=>({...a,halaqaNamesMap:c}))}else i(a=>({...a,halaqaNamesMap:d}));const[x,N,b]=await Promise.all([(0,n.GG)(s),(0,n.GG)(t),(0,n.GG)(l)]),f=x.size,E="teacher"===a?x.docs.reduce((a,e)=>{const s=e.data().halaqaId;return s&&!a.includes(s)&&a.push(s),a},[]).length:c.size,I=b.docs.filter(a=>"teacher"===a.data().role).length,D=((a,e)=>{const s={};return a.forEach(a=>{const t=a.data().halaqaId;if(t&&e[t]){const a=e[t];s[a]=(s[a]||0)+1}}),s})(x,d),{averageMemorization:C,averageRevision:R,averageAttendance:M}=(a=>{let e=0,s=0,t=0,r=0;a.forEach(a=>{const n=a.data();e+=n.pagesMemorized||0,s+=n.partsRevised||0,t+=n.attendanceDays||0,r++});const n=r>0?(e/r).toFixed(2):0,l=r>0?(s/r).toFixed(2):0,c=r>0?(t/r).toFixed(2):0;return{averageMemorization:parseFloat(n),averageRevision:parseFloat(l),averageAttendance:parseFloat(c)}})(N),k=new Date,w=(a=>{const e=new Date(a),s=e.getDay(),t=e.getDate()-s;return e.setDate(t),e.setHours(0,0,0,0),e})(k),A=(a=>{const e=new Date(a);return e.setDate(1),e.setHours(0,0,0,0),e})(k),G={},z={},y={};N.forEach(a=>{const e=a.data(),s=new Date(e.reportDate),t=parseFloat(e.rating)||0;s>=w&&s<=k&&(!G[e.studentId]||t>G[e.studentId].score)&&(G[e.studentId]={score:t,halaqaId:e.halaqaId}),s>=A&&s<=k&&((!z[e.studentId]||t>z[e.studentId].score)&&(z[e.studentId]={score:t,halaqaId:e.halaqaId}),y[e.halaqaId]||(y[e.halaqaId]={totalRating:0,count:0}),y[e.halaqaId].totalRating+=t,y[e.halaqaId].count++)});let S=null,B=-1;for(const a in G)G[a].score>B&&(B=G[a].score,S={id:a,name:m[a]||"\u063a\u064a\u0631 \u0645\u0639\u0631\u0648\u0641",score:B,halaqaName:d[G[a].halaqaId]||"\u063a\u064a\u0631 \u0645\u0639\u0631\u0648\u0641"});g(S);const J={};for(const a in G){const{score:e,halaqaId:s}=G[a];(!J[s]||e>J[s].score)&&(J[s]={id:a,name:m[a]||"\u063a\u064a\u0631 \u0645\u0639\u0631\u0648\u0641",score:e,halaqaName:d[s]||"\u063a\u064a\u0631 \u0645\u0639\u0631\u0648\u0641"})}v(J);let _=null,O=-1;for(const a in z)z[a].score>O&&(O=z[a].score,_={id:a,name:m[a]||"\u063a\u064a\u0631 \u0645\u0639\u0631\u0648\u0641",score:O,halaqaName:d[z[a].halaqaId]||"\u063a\u064a\u0631 \u0645\u0639\u0631\u0648\u0641"});q(_);const P={};for(const a in z){const{score:e,halaqaId:s}=z[a];(!P[s]||e>P[s].score)&&(P[s]={id:a,name:m[a]||"\u063a\u064a\u0631 \u0645\u0639\u0631\u0648\u0641",score:e,halaqaName:d[s]||"\u063a\u064a\u0631 \u0645\u0639\u0631\u0648\u0641"})}F(P);let H=null,T=-1;for(const a in y){const e=y[a].totalRating/y[a].count;e>T&&(T=e,H={id:a,name:d[a]||"\u063a\u064a\u0631 \u0645\u0639\u0631\u0648\u0641",averageRating:e.toFixed(2)})}j(H),i(e=>({...e,totalStudents:f,totalHalaqat:E,totalTeachers:"admin"===a?I:0,studentDistribution:D,averageMemorization:C,averageRevision:R,averageAttendance:M}))}catch(s){console.error("Error fetching statistics:",s),u("\u0641\u0634\u0644 \u0641\u064a \u062c\u0644\u0628 \u0627\u0644\u0625\u062d\u0635\u0627\u0626\u064a\u0627\u062a: "+s.message)}finally{h(!1)}},[a,e]);(0,t.useEffect)(()=>{"admin"===a||"teacher"===a?E():(h(!1),u("\u0644\u064a\u0633 \u0644\u062f\u064a\u0643 \u0627\u0644\u0635\u0644\u0627\u062d\u064a\u0629 \u0644\u0639\u0631\u0636 \u0647\u0630\u0647 \u0627\u0644\u0625\u062d\u0635\u0627\u0626\u064a\u0627\u062a."))},[a,E]);const I={labels:Object.keys(s.studentDistribution),datasets:[{data:Object.values(s.studentDistribution),backgroundColor:["#FF6384","#36A2EB","#FFCE56","#4BC0C0","#9966FF","#FF9F40","#E7E9ED","#8D6E63","#C0CA33","#7CB342"],hoverBackgroundColor:["#FF6384","#36A2EB","#FFCE56","#4BC0C0","#9966FF","#FF9F40","#E7E9ED","#8D6E63","#C0CA33","#7CB342"]}]},D={labels:["\u0645\u062a\u0648\u0633\u0637 \u0627\u0644\u062d\u0641\u0638","\u0645\u062a\u0648\u0633\u0637 \u0627\u0644\u0645\u0631\u0627\u062c\u0639\u0629","\u0645\u062a\u0648\u0633\u0637 \u0627\u0644\u062d\u0636\u0648\u0631"],datasets:[{label:"\u0627\u0644\u0645\u062a\u0648\u0633\u0637",data:[s.averageMemorization,s.averageRevision,s.averageAttendance],backgroundColor:["rgba(75, 192, 192, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)"],borderColor:["rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)"],borderWidth:1}]};return o?(0,d.jsx)("p",{className:"loading-message",children:"\u062c\u0627\u0631\u064a \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u0625\u062d\u0635\u0627\u0626\u064a\u0627\u062a..."}):m?(0,d.jsx)("p",{className:"error-message",children:m}):"admin"!==a&&"teacher"!==a?(0,d.jsx)("p",{className:"unauthorized-message",children:"\u0644\u064a\u0633 \u0644\u062f\u064a\u0643 \u0627\u0644\u0635\u0644\u0627\u062d\u064a\u0629 \u0644\u0639\u0631\u0636 \u0647\u0630\u0647 \u0627\u0644\u0625\u062d\u0635\u0627\u0626\u064a\u0627\u062a."}):(0,d.jsxs)("div",{className:"statistics-page-container page-container",children:[(0,d.jsx)("h2",{className:"statistics-page-title",children:"\u0627\u0644\u0625\u062d\u0635\u0627\u0626\u064a\u0627\u062a \u0627\u0644\u0639\u0627\u0645\u0629"}),(0,d.jsxs)("div",{className:"stats-summary",children:[(0,d.jsxs)("p",{children:["\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0637\u0644\u0627\u0628: ",(0,d.jsx)("span",{className:"stat-value",children:s.totalStudents})]}),(0,d.jsxs)("p",{children:["\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u062d\u0644\u0642\u0627\u062a: ",(0,d.jsx)("span",{className:"stat-value",children:s.totalHalaqat})]}),"admin"===a&&(0,d.jsxs)("p",{children:["\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0645\u0639\u0644\u0645\u064a\u0646: ",(0,d.jsx)("span",{className:"stat-value",children:s.totalTeachers})]})]}),(0,d.jsxs)("div",{className:"best-performers-section card",children:[(0,d.jsx)("h3",{className:"chart-title",children:"\u0623\u0641\u0636\u0644 \u0627\u0644\u0623\u062f\u0627\u0621"}),(0,d.jsxs)("div",{className:"best-item",children:[(0,d.jsx)("h4",{children:"\u0623\u0641\u0636\u0644 \u062d\u0644\u0642\u0629 \u0641\u064a \u0627\u0644\u0634\u0647\u0631 \u0627\u0644\u062d\u0627\u0644\u064a:"}),p?(0,d.jsxs)("p",{children:[(0,d.jsx)("span",{className:"performer-name",children:p.name})," \u0628\u0645\u062a\u0648\u0633\u0637 \u062a\u0642\u064a\u064a\u0645: ",(0,d.jsxs)("span",{className:"performer-score",children:[p.averageRating,"/100"]})]}):(0,d.jsx)("p",{className:"no-data-message-small",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0628\u064a\u0627\u0646\u0627\u062a \u0644\u0623\u0641\u0636\u0644 \u062d\u0644\u0642\u0629 \u0647\u0630\u0627 \u0627\u0644\u0634\u0647\u0631."})]}),(0,d.jsxs)("div",{className:"best-item",children:[(0,d.jsx)("h4",{children:"\u0623\u0641\u0636\u0644 \u0637\u0627\u0644\u0628 \u0641\u064a \u0627\u0644\u0623\u0633\u0628\u0648\u0639 \u0627\u0644\u062d\u0627\u0644\u064a (\u0639\u0644\u0649 \u0627\u0644\u062c\u0645\u064a\u0639):"}),x?(0,d.jsxs)("p",{children:[(0,d.jsx)("span",{className:"performer-name",children:x.name})," \u0645\u0646 \u062d\u0644\u0642\u0629 ",(0,d.jsx)("span",{className:"performer-halaqa",children:x.halaqaName})," \u0628\u062a\u0642\u064a\u064a\u0645: ",(0,d.jsxs)("span",{className:"performer-score",children:[x.score,"/100"]})]}):(0,d.jsx)("p",{className:"no-data-message-small",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0628\u064a\u0627\u0646\u0627\u062a \u0644\u0623\u0641\u0636\u0644 \u0637\u0627\u0644\u0628 \u0647\u0630\u0627 \u0627\u0644\u0623\u0633\u0628\u0648\u0639."})]}),(0,d.jsxs)("div",{className:"best-item",children:[(0,d.jsx)("h4",{children:"\u0623\u0641\u0636\u0644 \u0637\u0627\u0644\u0628 \u0641\u064a \u0627\u0644\u0623\u0633\u0628\u0648\u0639 \u0627\u0644\u062d\u0627\u0644\u064a (\u0644\u0643\u0644 \u062d\u0644\u0642\u0629):"}),Object.keys(N).length>0?(0,d.jsx)("ul",{children:Object.values(N).map((a,e)=>(0,d.jsxs)("li",{children:[(0,d.jsx)("span",{className:"performer-name",children:a.name})," \u0645\u0646 \u062d\u0644\u0642\u0629 ",(0,d.jsx)("span",{className:"performer-halaqa",children:a.halaqaName})," \u0628\u062a\u0642\u064a\u064a\u0645: ",(0,d.jsxs)("span",{className:"performer-score",children:[a.score,"/100"]})]},e))}):(0,d.jsx)("p",{className:"no-data-message-small",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0628\u064a\u0627\u0646\u0627\u062a \u0644\u0623\u0641\u0636\u0644 \u0637\u0627\u0644\u0628 \u0641\u064a \u0627\u0644\u0623\u0633\u0628\u0648\u0639 \u0644\u0643\u0644 \u062d\u0644\u0642\u0629."})]}),(0,d.jsxs)("div",{className:"best-item",children:[(0,d.jsx)("h4",{children:"\u0623\u0641\u0636\u0644 \u0637\u0627\u0644\u0628 \u0641\u064a \u0627\u0644\u0634\u0647\u0631 \u0627\u0644\u062d\u0627\u0644\u064a (\u0639\u0644\u0649 \u0627\u0644\u062c\u0645\u064a\u0639):"}),b?(0,d.jsxs)("p",{children:[(0,d.jsx)("span",{className:"performer-name",children:b.name})," \u0645\u0646 \u062d\u0644\u0642\u0629 ",(0,d.jsx)("span",{className:"performer-halaqa",children:b.halaqaName})," \u0628\u062a\u0642\u064a\u064a\u0645: ",(0,d.jsxs)("span",{className:"performer-score",children:[b.score,"/100"]})]}):(0,d.jsx)("p",{className:"no-data-message-small",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0628\u064a\u0627\u0646\u0627\u062a \u0644\u0623\u0641\u0636\u0644 \u0637\u0627\u0644\u0628 \u0647\u0630\u0627 \u0627\u0644\u0634\u0647\u0631."})]}),(0,d.jsxs)("div",{className:"best-item",children:[(0,d.jsx)("h4",{children:"\u0623\u0641\u0636\u0644 \u0637\u0627\u0644\u0628 \u0641\u064a \u0627\u0644\u0634\u0647\u0631 \u0627\u0644\u062d\u0627\u0644\u064a (\u0644\u0643\u0644 \u062d\u0644\u0642\u0629):"}),Object.keys(f).length>0?(0,d.jsx)("ul",{children:Object.values(f).map((a,e)=>(0,d.jsxs)("li",{children:[(0,d.jsx)("span",{className:"performer-name",children:a.name})," \u0645\u0646 \u062d\u0644\u0642\u0629 ",(0,d.jsx)("span",{className:"performer-halaqa",children:a.halaqaName})," \u0628\u062a\u0642\u064a\u064a\u0645: ",(0,d.jsxs)("span",{className:"performer-score",children:[a.score,"/100"]})]},e))}):(0,d.jsx)("p",{className:"no-data-message-small",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0628\u064a\u0627\u0646\u0627\u062a \u0644\u0623\u0641\u0636\u0644 \u0637\u0627\u0644\u0628 \u0641\u064a \u0627\u0644\u0634\u0647\u0631 \u0644\u0643\u0644 \u062d\u0644\u0642\u0629."})]})]}),(0,d.jsxs)("div",{className:"charts-grid",children:[(0,d.jsxs)("div",{className:"chart-card",children:[(0,d.jsx)("h3",{className:"chart-title",children:"\u062a\u0648\u0632\u064a\u0639 \u0627\u0644\u0637\u0644\u0627\u0628 \u062d\u0633\u0628 \u0627\u0644\u062d\u0644\u0642\u0629"}),(0,d.jsx)("div",{className:"chart-container",children:Object.keys(s.studentDistribution).length>0?(0,d.jsx)(c.Fq,{data:I,options:{responsive:!0,maintainAspectRatio:!1}}):(0,d.jsx)("p",{className:"no-chart-data",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0628\u064a\u0627\u0646\u0627\u062a \u0644\u062a\u0648\u0632\u064a\u0639 \u0627\u0644\u0637\u0644\u0627\u0628."})})]}),(0,d.jsxs)("div",{className:"chart-card",children:[(0,d.jsx)("h3",{className:"chart-title",children:"\u0645\u062a\u0648\u0633\u0637 \u0627\u0644\u062d\u0641\u0638\u060c \u0627\u0644\u0645\u0631\u0627\u062c\u0639\u0629\u060c \u0648\u0627\u0644\u062d\u0636\u0648\u0631"}),(0,d.jsx)("div",{className:"chart-container",children:s.averageMemorization>0||s.averageRevision>0||s.averageAttendance>0?(0,d.jsx)(c.yP,{data:D,options:{responsive:!0,maintainAspectRatio:!1}}):(0,d.jsx)("p",{className:"no-chart-data",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0628\u064a\u0627\u0646\u0627\u062a \u0644\u0645\u062a\u0648\u0633\u0637\u0627\u062a \u0627\u0644\u0623\u062f\u0627\u0621."})})]})]})]})}i.t1.register(i.Bs,i.m_,i.s$,i.PP,i.kc,i.E8,i.hE)}}]);
//# sourceMappingURL=985.d03550e2.chunk.js.map